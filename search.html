<!doctype html>
<html lang="en-us">

<head>
  <meta charset="UTF-8" />
  <meta name = "viewport" content="width=device-width, initial-scale= 1.0">
  <title>Binge Watch Search</title>
  <link rel="stylesheet" type="text/css" href="assets/css/style.css"/>

  <link
    rel="stylesheet"
    href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
  <link
    rel="stylesheet"
    href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"/>
  
  <!-----Firebase references needs to be here             -->
  <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-auth.js"></script>
  
  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="assets/javascript/app.js"></script>   

</head>
<body>
  <style>
    #movie-view{
      display: flex;
      flex-wrap: wrap;
    }
    .movie-container{
      display: flex;
      flex-direction: column;
      height: auto;
      margin: 3vw;
      text-align: center;
      cursor: pointer;
    }
  </style>
<!---------------------------------------------------------------------------------------->
  <header id="masthead">
    <div class="container">
      <div class="sticky-header">         
        <nav>
            <h1> Binge Watch </h1>
            <h4>Search thousands of movies and TV titles add them to your list</h4>
  <!--       <button id="mylist" href="mylist_index.html"><strong>My List</strong></button>   ------->
            <p id = "myloid"> Hello xxxx  logon id goes here?  move to the right</p>
            <a id = "mylist"  href="myList.html">Go To My Binge List</a>    
            <hr size=10>
        </nav>
    </div>
  </div>
  </header>
<!---------------------------------------------------------------------------------------->
       <!-- This form will be where users input data about the movies -->
       <form id="movie-form">
        <label for="movie-input">Search for a movie</label>
        <input type="text" id="movie-input" /><br />

        <!-- This button will trigger our AJAX call -->
        <input id="find-movie" type="submit" value="Movie Search" />
      </form>

      <!-- We'll be dumping our JSON contents in here -->
      <h3>Search Results</h3>
      <div id="movie-view"></div>

      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
      <script type="text/javascript">
        // This .on("click") function will trigger the AJAX Call
        $("#find-movie").on("click", function(event) {
          // Preventing the submit button from trying to submit the form
          // We're optionally using a form so the user may hit Enter to search instead of clicking the button
          event.preventDefault();
          // Here we grab the text from the input box
          var movie = $("#movie-input").val();
          $("#movie-view").empty();
          // Here we construct our URL
          var queryURL =
            "https://www.omdbapi.com/?s=" +
            movie +
            "&type=movie" +
            "&apikey=trilogy&page=1";

          // Write code between the dashes below to hit the queryURL with $ajax, then take the response data
          // and display it in the div with an id of movie-view

          // YOUR CODE GOES IN THESE DASHES. DO NOT MANUALLY EDIT THE HTML ABOVE
          $.ajax({
            url: queryURL,
            method: "GET"
          }).then(function(response) {
            // console.log(response.Search);
            // $("#movie-view").text(JSON.stringify(response));

            //Appending all possible results of search onto page in form of Poster, Title
            let len = response.Search.length;
            console.log(len);
            console.log(response.Search);
            for (let m = 0; m < len; m++){
              //creating Objects
              let object = $("<div>");
              let image = $("<img src = " + response.Search[m].Poster + " alt = 'Poster is N/A'>");
              let title = response.Search[m].Title;
              //creating overall class and unique IDs
              $(object).addClass("movie-container");
              $(object).addClass("clickable");
              $(object).attr('id', response.Search[m].imdbID);
              //appending into #movie-view
              $(object).append(image);
              $(object).append(title);
              $("#movie-view").append(object);
            }
          });
          // =================================================================

          // CODE GOES HERE
          $(document.body).on("click", ".clickable", function() {
            let movieFireBase = $(this).attr('id');
            $(this).removeClass("clickable");
            console.log(movieFireBase);
            //At the moment it is immediately pushing. Plan to push into array and place into database as an array
            database.ref("DXji6kUNySV5oc5x80REEeuSRfH3").push({
              movievalue: movieFireBase
            });
          })

       
          $(document.body).on("click", ".clickable", function() {
            let movieFireBase = $(this).attr('id');
            $(this).removeClass("clickable");
            console.log(movieFireBase);
            //At the moment it is immediately pushing. Plan to push into array and place into database as an array
            database.ref("DXji6kUNySV5oc5x80REEeuSRfH3").push({
              movievalue: movieFireBase
            });
          });
        });
      </script>
    </div>
  </body>
</html>
